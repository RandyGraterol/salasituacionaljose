<%- include('../layout', { body: `
<div class="container mx-auto px-4 py-8">
  <div class="bg-white rounded-lg shadow-md p-6">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">Ranking de Municipios</h1>
    
    <!-- Filtros -->
    <form method="GET" action="/evaluacion/ranking" class="mb-6 bg-gray-50 p-4 rounded-lg">
      <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Métrica</label>
          <select 
            name="metrica"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            <option value="final" ${metricaSeleccionada === 'final' ? 'selected' : ''}>Puntuación Final</option>
            <option value="cobertura" ${metricaSeleccionada === 'cobertura' ? 'selected' : ''}>Cobertura</option>
            <option value="puntualidad" ${metricaSeleccionada === 'puntualidad' ? 'selected' : ''}>Puntualidad</option>
            <option value="calidad" ${metricaSeleccionada === 'calidad' ? 'selected' : ''}>Calidad</option>
            <option value="cantidad" ${metricaSeleccionada === 'cantidad' ? 'selected' : ''}>Cantidad</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Mes</label>
          <input 
            type="number" 
            name="mes" 
            min="1" 
            max="12" 
            value="${filtros.mes}"
            placeholder="1-12"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Año</label>
          <input 
            type="number" 
            name="anio" 
            min="2020" 
            max="2100" 
            value="${filtros.anio}"
            placeholder="2024"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">División</label>
          <select 
            name="divisionId"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            <option value="">Todas las divisiones</option>
            ${divisiones.map(d => `
              <option value="${d.id}" ${filtros.divisionId == d.id ? 'selected' : ''}>
                ${d.nombre}
              </option>
            `).join('')}
          </select>
        </div>
        
        <div class="flex items-end">
          <button 
            type="submit"
            class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors"
          >
            Actualizar
          </button>
        </div>
      </div>
    </form>

    ${error ? `
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        ${error}
      </div>
    ` : ''}

    <!-- Ranking -->
    ${ranking.length > 0 ? `
      <div class="space-y-3">
        ${ranking.map((item, index) => {
          const getMedalClass = () => {
            if (index === 0) return 'bg-gradient-to-r from-yellow-400 to-yellow-500 text-yellow-900';
            if (index === 1) return 'bg-gradient-to-r from-gray-300 to-gray-400 text-gray-900';
            if (index === 2) return 'bg-gradient-to-r from-orange-400 to-orange-500 text-orange-900';
            return 'bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700';
          };
          
          const getBarWidth = () => {
            const maxValor = ranking[0].valor;
            return maxValor > 0 ? (item.valor / maxValor) * 100 : 0;
          };
          
          return `
            <div class="${getMedalClass()} rounded-lg shadow-md overflow-hidden">
              <div class="flex items-center p-4">
                <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-full bg-white bg-opacity-30 font-bold text-xl mr-4">
                  ${item.posicion}
                </div>
                
                <div class="flex-grow">
                  <div class="flex justify-between items-center mb-1">
                    <span class="font-semibold text-lg">${item.municipio}</span>
                    <span class="font-bold text-xl">${item.valor.toFixed(2)}</span>
                  </div>
                  
                  <div class="w-full bg-white bg-opacity-30 rounded-full h-2">
                    <div 
                      class="bg-white bg-opacity-60 h-2 rounded-full transition-all duration-500"
                      style="width: ${getBarWidth()}%"
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          `;
        }).join('')}
      </div>
      
      <!-- Botones de navegación -->
      <div class="mt-6 flex gap-4">
        <a 
          href="/evaluacion/avanzada?mes=${filtros.mes}&anio=${filtros.anio}&divisionId=${filtros.divisionId}"
          class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition-colors"
        >
          Volver a Evaluación Avanzada
        </a>
      </div>
    ` : `
      <div class="text-center py-8 text-gray-500">
        No hay datos de ranking disponibles con los filtros seleccionados.
      </div>
    `}
  </div>
</div>
`}) %>
